<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab Virtual & Persiapan Formatif - Pertemuan 4</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <!-- Konfigurasi MathJax -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; scroll-behavior: smooth; }
        .canvas-container { position: relative; width: 100%; height: 400px; background: white; border-radius: 1rem; overflow: hidden; border: 1px solid #e2e8f0; }
        #inclineCanvas { width: 100%; height: 100%; }
        .control-panel { background: white; padding: 1.5rem; border-radius: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        input[type=range] { width: 100%; cursor: pointer; accent-color: #2563eb; }
        .section-card { background: white; padding: 2.5rem; border-radius: 1.5rem; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05); margin-bottom: 2rem; border: 1px solid #f1f5f9; }
        .solution-content { display: none; }
        .solution-content.active { display: block; animation: slideDown 0.4s ease-out; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .nav-link { transition: all 0.3s ease; }
        .nav-link:hover { transform: translateY(-2px); }
    </style>
</head>
<body class="p-4 md:p-8 text-slate-800">
    <div class="max-w-6xl mx-auto">
        
        <!-- Navigasi Sticky -->
        <nav class="mb-12 flex flex-wrap gap-3 justify-center sticky top-4 z-50">
            <a href="#simulator" class="nav-link px-5 py-2.5 bg-blue-600 text-white rounded-full text-sm font-bold shadow-xl hover:bg-blue-700">Simulator</a>
            <a href="#materi" class="nav-link px-5 py-2.5 bg-white text-slate-600 border border-slate-200 rounded-full text-sm font-bold shadow-sm hover:bg-slate-50">Materi</a>
            <a href="#contoh" class="nav-link px-5 py-2.5 bg-white text-slate-600 border border-slate-200 rounded-full text-sm font-bold shadow-sm hover:bg-slate-50">Contoh</a>
            <a href="#latihan-mandiri" class="nav-link px-5 py-2.5 bg-white text-slate-600 border border-slate-200 rounded-full text-sm font-bold shadow-sm hover:bg-slate-50">Latihan</a>
            <a href="#latihan-persiapan" class="nav-link px-5 py-2.5 bg-indigo-600 text-white rounded-full text-sm font-bold shadow-xl hover:bg-indigo-700">Persiapan Formatif</a>
        </nav>

        <!-- Header -->
        <header class="mb-12 text-center" id="simulator">
            <div class="inline-block px-4 py-1.5 bg-blue-100 text-blue-700 rounded-full text-xs font-black uppercase tracking-widest mb-4">Pertemuan 4</div>
            <h1 class="text-4xl md:text-5xl font-black text-slate-900 mb-4 tracking-tight">Dinamika & Gaya Gesek</h1>
            <p class="text-slate-500 text-lg max-w-2xl mx-auto">Eksperimen interaktif gaya tarik dan dorong pada bidang miring dengan analisis arah gerak yang akurat.</p>
        </header>

        <!-- SIMULATOR SECTION -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mb-8">
            <!-- Sidebar Kontrol -->
            <div class="lg:col-span-4 space-y-6">
                <div class="control-panel border-t-4 border-blue-600">
                    <h2 class="text-lg font-bold mb-6 flex items-center gap-2 text-slate-800">
                        <i data-lucide="settings-2" class="text-blue-600" size="20"></i> Kontrol Simulasi
                    </h2>
                    <div class="space-y-6">
                        <!-- Kontrol Posisi -->
                        <div>
                            <div class="flex justify-between mb-2 text-sm font-bold text-slate-700">
                                <label>Atur Posisi Awal ($x$)</label>
                                <span id="val-pos" class="text-indigo-600">30%</span>
                            </div>
                            <input type="range" id="input-pos" min="0" max="100" value="30">
                        </div>

                        <div class="pt-4 border-t border-slate-100">
                            <div class="flex justify-between mb-2 text-sm font-bold text-slate-700">
                                <label>Sudut Kemiringan ($\theta$)</label>
                                <span id="val-theta" class="text-blue-600">30°</span>
                            </div>
                            <input type="range" id="input-theta" min="0" max="75" value="30">
                        </div>

                        <div>
                            <div class="flex justify-between mb-2 text-sm font-bold text-red-600">
                                <label>Gaya Luar ($F_{ext}$)</label>
                                <span id="val-fext">0 N</span>
                            </div>
                            <div class="flex items-center gap-2 text-[10px] text-slate-400 mb-1 font-mono uppercase">
                                <span>Tarik Atas (-)</span>
                                <span class="flex-grow text-center text-slate-300">|</span>
                                <span>Dorong Bawah (+)</span>
                            </div>
                            <input type="range" id="input-fext" min="-120" max="120" step="1" value="0">
                        </div>

                        <div class="pt-4 border-t border-slate-100">
                            <div class="flex justify-between mb-2 text-sm font-bold text-slate-700">
                                <label>Massa Benda ($m$)</label>
                                <span id="val-mass">2 kg</span>
                            </div>
                            <input type="range" id="input-mass" min="1" max="20" value="2">
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4 text-slate-700">
                            <div>
                                <label class="text-[10px] font-bold text-orange-600 uppercase tracking-widest">$\mu_s$ (Statik)</label>
                                <input type="range" id="input-mus" min="0" max="1" step="0.01" value="0.50">
                                <span id="val-mus" class="text-xs font-mono">0.50</span>
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-orange-600 uppercase tracking-widest">$\mu_k$ (Kinetik)</label>
                                <input type="range" id="input-muk" min="0" max="1" step="0.01" value="0.30">
                                <span id="val-muk" class="text-xs font-mono">0.30</span>
                            </div>
                        </div>

                        <!-- Tombol Aksi -->
                        <div class="flex gap-2 pt-2">
                            <button id="start-btn" class="flex-grow py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 flex items-center justify-center gap-2 transition-all active:scale-95 shadow-lg">
                                <i data-lucide="play" size="18" id="play-icon"></i> <span id="play-text">Mulai</span>
                            </button>
                            <button id="reset-btn" class="w-14 py-3 bg-slate-200 text-slate-600 rounded-xl font-bold hover:bg-slate-300 flex items-center justify-center transition-all active:scale-95 shadow-md">
                                <i data-lucide="rotate-ccw" size="18"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Canvas & Hasil -->
            <div class="lg:col-span-8 space-y-6">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="font-bold text-slate-800 uppercase tracking-widest text-xs flex items-center gap-2">
                            <i data-lucide="activity" class="text-blue-500"></i> Diagram Benda Bebas (FBD)
                        </h2>
                        <span id="status-badge" class="px-4 py-1 rounded-full text-[10px] font-black uppercase bg-slate-100 text-slate-500 shadow-sm transition-colors tracking-tighter">Siap</span>
                    </div>
                    <div class="canvas-container shadow-inner bg-slate-50">
                        <canvas id="inclineCanvas"></canvas>
                    </div>
                </div>

                <!-- Hasil Kalkulasi Grid -->
                <div class="grid grid-cols-2 lg:grid-cols-3 gap-3">
                    <div class="bg-white p-4 rounded-xl border border-slate-100 shadow-sm text-center">
                        <p class="text-[9px] text-slate-400 font-bold uppercase tracking-widest">$w_x$ (Grav)</p>
                        <p id="calc-wx" class="text-lg font-black text-blue-700">0 N</p>
                    </div>
                    <div class="bg-white p-4 rounded-xl border border-slate-100 shadow-sm text-center">
                        <p class="text-[9px] text-slate-400 font-bold uppercase tracking-widest">$F_{ext}$ (Luar)</p>
                        <p id="calc-fext" class="text-lg font-black text-red-700">0 N</p>
                    </div>
                    <div class="bg-white p-4 rounded-xl border border-slate-100 shadow-sm text-center">
                        <p class="text-[9px] text-slate-400 font-bold uppercase tracking-widest">$N$ (Normal)</p>
                        <p id="calc-normal" class="text-lg font-black text-emerald-700">0 N</p>
                    </div>
                    <div class="bg-white p-4 rounded-xl border border-slate-100 shadow-sm text-center">
                        <p class="text-[9px] text-slate-400 font-bold uppercase tracking-widest">$f_{s,max}$</p>
                        <p id="calc-fsmax" class="text-lg font-black text-slate-700">0 N</p>
                    </div>
                    <div class="bg-white p-4 rounded-xl border border-slate-100 shadow-sm text-center border-orange-100">
                        <p class="text-[9px] text-orange-400 font-bold uppercase tracking-widest">$f$ Aktif</p>
                        <p id="calc-factive" class="text-lg font-black text-orange-700">0 N</p>
                    </div>
                    <div class="bg-white p-4 rounded-xl border border-slate-100 shadow-sm text-center border-indigo-100">
                        <p class="text-[9px] text-indigo-400 font-bold uppercase tracking-widest">$a$ ($m/s^2$)</p>
                        <p id="calc-acc" class="text-lg font-black text-indigo-700">0</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- NEW ANALYSIS PANEL -->
        <div class="section-card border-l-8 border-slate-800 bg-slate-900 text-slate-300">
            <div class="flex items-center gap-3 mb-6">
                <i data-lucide="calculator" class="text-blue-400" size="24"></i>
                <h2 class="text-xl font-black text-white uppercase tracking-tight">Analisis Dinamika Mendalam</h2>
            </div>
            <div id="detailed-analysis-box" class="space-y-6 text-sm leading-relaxed">
                <!-- Konten dinamis akan masuk ke sini via JS -->
                <p class="italic text-slate-500">Menganalisis parameter...</p>
            </div>
        </div>

        <!-- SECTION: MATERI -->
        <section id="materi" class="section-card border-l-8 border-blue-500">
            <h2 class="text-3xl font-black text-slate-900 mb-8 flex items-center gap-3">
                <i data-lucide="book-open" class="text-blue-600"></i> Penjelasan Analisis Gaya
            </h2>
            <div class="prose max-w-none text-slate-600 text-lg leading-relaxed">
                <p>Benda pada bidang miring dipengaruhi oleh resultan antara gaya berat ($w$), gaya luar ($F_{ext}$), dan gaya gesek ($f$). Penting untuk memahami arah kerja masing-masing gaya:</p>
                <div class="my-8 p-8 bg-slate-50 rounded-3xl border border-slate-100 font-mono text-center shadow-inner">
                    <p class="text-sm text-slate-400 mb-4 uppercase">Gaya Penggerak Total ($F_{drive}$)</p>
                    <p class="text-3xl font-black text-slate-900">$$F_{drive} = F_{ext} + (-w_x)$$</p>
                    <p class="text-xs text-slate-400 mt-2">Arah Positif (+) Ke Puncak | Arah Negatif (-) Ke Dasar</p>
                </div>
                <ul class="space-y-4">
                    <li class="flex items-start gap-3">
                        <div class="p-1 bg-blue-100 rounded-full mt-1"><i data-lucide="check" size="14" class="text-blue-600"></i></div>
                        <p><strong>Gaya Berat Sejajar ($w_x$):</strong> Selalu menarik benda ke arah dasar bidang (bernilai negatif karena arahnya ke bawah).</p>
                    </li>
                    <li class="flex items-start gap-3">
                        <div class="p-1 bg-red-100 rounded-full mt-1"><i data-lucide="check" size="14" class="text-red-600"></i></div>
                        <p><strong>Gaya Luar ($F_{ext}$):</strong> Dorongan positif (+) menekan benda ke dasar, tarikan negatif (-) mengangkat benda ke puncak.</p>
                    </li>
                    <li class="flex items-start gap-3">
                        <div class="p-1 bg-orange-100 rounded-full mt-1"><i data-lucide="check" size="14" class="text-orange-600"></i></div>
                        <p><strong>Gaya Gesek ($f$):</strong> Selalu melawan arah kecenderungan gerak. Jika benda mencoba naik, gesekan menarik turun, dan sebaliknya.</p>
                    </li>
                </ul>
            </div>
        </section>

        <!-- SECTION: CONTOH SOAL (3 MODEL) -->
        <section id="contoh" class="section-card border-l-8 border-emerald-500">
            <h2 class="text-3xl font-black text-slate-900 mb-8 flex items-center gap-3">
                <i data-lucide="lightbulb" class="text-emerald-600"></i> Contoh Soal (3 Model)
            </h2>
            <div class="space-y-6 text-slate-700">
                <div class="p-6 bg-slate-50 rounded-2xl border border-slate-100">
                    <span class="px-2 py-1 bg-emerald-600 text-white text-[10px] font-bold rounded mb-2 inline-block uppercase">Model 1: Penentuan Status Gerak</span>
                    <p class="font-bold text-slate-800 mb-4">Balok 5 kg, $\theta = 30^\circ$, $\mu_s = 0,6$. Apakah benda bergerak?</p>
                    <button onclick="toggleSolution('sol-c1')" class="text-xs font-black text-emerald-600 flex items-center gap-1 hover:underline">
                        <i data-lucide="eye" size="14"></i> Lihat Analisis
                    </button>
                    <div id="sol-c1" class="solution-content mt-4 p-5 bg-white rounded-xl border border-emerald-100 space-y-2 text-sm">
                        <p>1. $w_x = 5 \cdot 10 \cdot \sin 30^\circ = 25$ N (Menarik Turun)</p>
                        <p>2. $N = 5 \cdot 10 \cdot \cos 30^\circ = 43,3$ N</p>
                        <p>3. $f_{s,max} = 0,6 \cdot 43,3 = 25,98$ N</p>
                        <p class="font-bold text-emerald-700">Hasil: DIAM (karena $25 < 25,98$ N)</p>
                    </div>
                </div>
                <div class="p-6 bg-slate-50 rounded-2xl border border-slate-100">
                    <span class="px-2 py-1 bg-blue-600 text-white text-[10px] font-bold rounded mb-2 inline-block uppercase">Model 2: Menghitung Percepatan</span>
                    <p class="font-bold text-slate-800 mb-4">Balok 2 kg, $\theta = 45^\circ$, $\mu_k = 0,2$. Berapa percepatannya?</p>
                    <button onclick="toggleSolution('sol-c2')" class="text-xs font-black text-blue-600 flex items-center gap-1 hover:underline">
                        <i data-lucide="eye" size="14"></i> Lihat Analisis
                    </button>
                    <div id="sol-c2" class="solution-content mt-4 p-5 bg-white rounded-xl border border-blue-100 space-y-2 text-sm">
                        <p>1. $w_x = 2 \cdot 10 \cdot 0,7 = 14$ N</p>
                        <p>2. $f_k = \mu_k \cdot N = 0,2 \cdot 14 = 2,8$ N</p>
                        <p>3. $a = (14 - 2,8) / 2 = 5,6 \, m/s^2$</p>
                    </div>
                </div>
                <div class="p-6 bg-slate-50 rounded-2xl border border-slate-100">
                    <span class="px-2 py-1 bg-orange-600 text-white text-[10px] font-bold rounded mb-2 inline-block uppercase">Model 3: Sudut Kritis</span>
                    <p class="font-bold text-slate-800 mb-4">Berapa sudut kemiringan minimal agar benda tepat bergerak jika $\mu_s = 0,75$?</p>
                    <button onclick="toggleSolution('sol-c3')" class="text-xs font-black text-orange-600 flex items-center gap-1 hover:underline">
                        <i data-lucide="eye" size="14"></i> Lihat Analisis
                    </button>
                    <div id="sol-c3" class="solution-content mt-4 p-5 bg-white rounded-xl border border-orange-100 space-y-2 text-sm text-slate-600">
                        <p>Gunakan rumus: $\tan \theta = \mu_s$</p>
                        <p>$\tan \theta = 0,75 \rightarrow \theta = \arctan(0,75) = 37^\circ$</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION: LATIHAN MANDIRI -->
        <section id="latihan-mandiri" class="section-card border-l-8 border-red-500">
            <h2 class="text-3xl font-black text-slate-900 mb-8 flex items-center gap-3">
                <i data-lucide="pencil" class="text-red-600"></i> Latihan Mandiri
            </h2>
            <div class="grid gap-4 text-slate-700">
                <div class="p-4 bg-slate-50 rounded-xl border border-slate-200">
                    <p class="text-sm font-semibold mb-2">Soal 1: Balok 10 kg, $\theta = 30^\circ$, $\mu_s = 0,4$. Tentukan besar gaya gesek yang bekerja saat benda dilepas!</p>
                    <button onclick="toggleSolution('sol-l1')" class="text-[10px] font-bold text-red-600 uppercase hover:underline">Lihat Langkah Kerja</button>
                    <div id="sol-l1" class="solution-content mt-2 p-3 bg-white border border-red-100 rounded text-xs leading-relaxed">
                        - $w_x = 50$ N<br>- $f_{s,max} = 0,4 \cdot (10 \cdot 10 \cdot 0,866) = 34,6$ N.<br>Karena $50 > 34,6$, benda bergerak. Gaya gesek = gaya kinetik.
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION: PERSIAPAN FORMATIF -->
        <section id="latihan-persiapan" class="section-card border-t-8 border-indigo-600 bg-slate-50">
            <div class="mb-10">
                <h2 class="text-3xl md:text-4xl font-black text-slate-900 flex items-center gap-4">
                    <i data-lucide="graduation-cap" class="text-indigo-600" size="40"></i> Persiapan Formatif 1
                </h2>
                <p class="text-slate-500 mt-2 font-medium">Latihan Analisis Hukum Newton (Gunakan $g = 10 \text{ m/s}^2$)</p>
            </div>

            <div class="space-y-8">
                <!-- Bus Deni -->
                <div class="p-8 bg-white rounded-3xl shadow-sm border border-slate-200">
                    <h4 class="font-black text-slate-900 text-xl tracking-tight uppercase mb-4 text-sm">Soal 1: Perjalanan Bus Deni</h4>
                    <p class="text-slate-600 mb-6 leading-relaxed">
                        Tubuh Deni terdorong ke depan saat bus mengerem mendadak. Analisis fenomena ini menggunakan Hukum I dan III Newton!
                    </p>
                    <button onclick="toggleSolution('sol-form-1')" class="text-sm font-black text-indigo-600 flex items-center gap-2 hover:translate-x-1 transition-all">
                        <i data-lucide="chevron-right" size="18"></i> Lihat Jawaban
                    </button>
                    <div id="sol-form-1" class="solution-content mt-6 p-6 bg-indigo-50 rounded-2xl text-sm space-y-4 text-slate-700">
                        <p>Hukum I (Inersia): Tubuh Deni ingin mempertahankan kecepatannya, sehingga tetap maju saat bus berhenti.</p>
                        <p>Hukum III (Aksi-Reaksi): Saat Deni menarik tiang, tiang memberikan gaya balik yang sama besar ke tangan Deni.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- FOOTER -->
        <footer class="mt-12 text-center text-slate-400 text-xs pb-16">
            &copy; 2024 Lab Fisika SMA SLH Plus &bull; Geraldo Rumapea, S.Pd.
        </footer>
    </div>

    <script>
        // --- KONFIGURASI STATE ---
        const state = { 
            theta: 30, 
            mass: 2, 
            fext: 0, 
            mus: 0.50, 
            muk: 0.30, 
            g: 10, 
            pos: 30, 
            vel: 0, 
            isMoving: false, 
            isRunning: false, 
            lastTime: 0 
        };

        let canvas, ctx, inputs, displays;

        function initElements() {
            canvas = document.getElementById('inclineCanvas');
            ctx = canvas.getContext('2d');
            inputs = { 
                theta: document.getElementById('input-theta'), 
                mass: document.getElementById('input-mass'), 
                fext: document.getElementById('input-fext'), 
                pos: document.getElementById('input-pos'),
                mus: document.getElementById('input-mus'), 
                muk: document.getElementById('input-muk') 
            };
            displays = { 
                theta: document.getElementById('val-theta'), 
                mass: document.getElementById('val-mass'), 
                fext: document.getElementById('val-fext'), 
                pos: document.getElementById('val-pos'),
                mus: document.getElementById('val-mus'),
                muk: document.getElementById('val-muk'),
                wx: document.getElementById('calc-wx'), 
                fextCalc: document.getElementById('calc-fext'), 
                normal: document.getElementById('calc-normal'), 
                fsmax: document.getElementById('calc-fsmax'), 
                factive: document.getElementById('calc-factive'),
                acc: document.getElementById('calc-acc'), 
                status: document.getElementById('status-badge'), 
                logic: document.getElementById('logic-box'),
                playIcon: document.getElementById('play-icon'),
                playText: document.getElementById('play-text'),
                startBtn: document.getElementById('start-btn'),
                detailedAnalysis: document.getElementById('detailed-analysis-box')
            };
        }

        function toggleSolution(id) { 
            const el = document.getElementById(id); 
            if (el) el.classList.toggle('active'); 
        }

        function calculatePhysics() {
            if (!displays) return { a: 0, statusText: "Siap" };

            const rad = state.theta * (Math.PI / 180);
            const wx = state.mass * state.g * Math.sin(rad); 
            const N = state.mass * state.g * Math.cos(rad);
            const fsMax = state.mus * N;
            const fk = state.muk * N;

            // Fext (-) tarik puncak, (+) dorong dasar. w_x selalu tarik dasar.
            // forceTowardsPeak: (+) ke puncak, (-) ke dasar
            const forceTowardsPeak = -state.fext - wx; 
            
            let a = 0; 
            let fFriction = 0;
            let statusText = "Diam"; 
            let moveDir = 0; // 1: Atas, -1: Bawah

            if (!state.isMoving) {
                if (Math.abs(forceTowardsPeak) > fsMax + 0.01) { 
                    if (state.isRunning) state.isMoving = true;
                    statusText = forceTowardsPeak > 0 ? "Mulai Tertarik ke Atas" : "Mulai Meluncur ke Bawah";
                    moveDir = Math.sign(forceTowardsPeak);
                    fFriction = -moveDir * fk;
                } else {
                    statusText = Math.abs(forceTowardsPeak) < 0.2 ? "Diam (Setimbang)" : (forceTowardsPeak > 0 ? "Diam (Cenderung Naik)" : "Diam (Cenderung Turun)");
                    fFriction = -forceTowardsPeak;
                    a = 0;
                }
            }

            if (state.isMoving) {
                moveDir = state.vel === 0 ? Math.sign(forceTowardsPeak) : Math.sign(state.vel);
                fFriction = -moveDir * fk;
                const netForce = forceTowardsPeak + fFriction;
                a = netForce / state.mass;

                if (state.isRunning && Math.abs(state.vel) < 0.01 && Math.abs(forceTowardsPeak) <= fsMax) {
                    a = 0; state.vel = 0; state.isMoving = false;
                    statusText = "Benda Berhenti";
                } else {
                    statusText = moveDir > 0 ? "Tertarik ke Atas" : "Meluncur ke Bawah";
                }
            }

            // Update Panel
            displays.wx.innerText = wx.toFixed(1) + " N";
            displays.fextCalc.innerText = state.fext.toFixed(1) + " N";
            displays.normal.innerText = N.toFixed(1) + " N";
            displays.fsmax.innerText = fsMax.toFixed(1) + " N";
            displays.factive.innerText = Math.abs(fFriction).toFixed(1) + " N";
            displays.acc.innerText = a.toFixed(2);
            displays.status.innerText = statusText;

            updateDetailedAnalysis(wx, N, fsMax, fk, forceTowardsPeak, fFriction, a, statusText);

            return { a, statusText, fFriction };
        }

        function updateDetailedAnalysis(wx, N, fsMax, fk, drive, friction, a, status) {
            let html = "";
            
            // Tahap 1
            html += `<div><strong class="text-blue-400">Langkah 1: Analisis Gaya Penggerak (Driving Force)</strong><br>`;
            html += `Gaya berat sejajar bidang: $w_x = m \\cdot g \\cdot \\sin(${state.theta}^\\circ) = ${wx.toFixed(1)}$ N (Arah ke Dasar).<br>`;
            html += `Gaya Luar ($F_{ext}$): ${state.fext.toFixed(1)} N.<br>`;
            html += `Resultan Penggerak ($F_{drive}$): $${drive.toFixed(1)}$ N (${drive > 0 ? 'Cenderung ke Puncak' : 'Cenderung ke Dasar'}).</div>`;

            // Tahap 2
            html += `<div><strong class="text-emerald-400">Langkah 2: Menentukan Ambang Batas Gesek Statis</strong><br>`;
            html += `Gaya Normal ($N$): $m \\cdot g \\cdot \\cos(${state.theta}^\\circ) = ${N.toFixed(1)}$ N.<br>`;
            html += `Ambang Gesek Maksimum ($f_{s,max}$): $\\mu_s \\cdot N = ${state.mus} \\cdot ${N.toFixed(1)} = ${fsMax.toFixed(1)}$ N.</div>`;

            // Tahap 3
            html += `<div><strong class="text-orange-400">Langkah 3: Perbandingan & Kesimpulan</strong><br>`;
            const isEscaped = Math.abs(drive) > fsMax;
            html += `Apakah $|F_{drive}| > f_{s,max}$? $\\rightarrow |${drive.toFixed(1)}| > ${fsMax.toFixed(1)}$ adalah <strong class="text-white">${isEscaped ? 'YA' : 'TIDAK'}</strong>.<br>`;
            
            if (!isEscaped) {
                html += `Kesimpulan: Gaya penggerak <strong>tidak mampu</strong> melawan gesekan statis maksimum. Benda tetap <strong class="text-white">DIAM</strong>. Gaya gesek yang bekerja saat ini ($f_{aktif}$) adalah sebesar gaya pendorongnya sendiri agar setimbang ($f = ${Math.abs(friction).toFixed(1)}$ N).</div>`;
            } else {
                html += `Kesimpulan: Gaya penggerak <strong>berhasil</strong> melampaui hambatan statis. Benda akan <strong class="text-white">BERGERAK</strong>. Gesekan yang bekerja sekarang berubah menjadi gesekan kinetik ($f_k = \\mu_k \\cdot N = ${fk.toFixed(1)}$ N).<br>`;
                html += `Percepatan ($a$): $(F_{drive} - f_k) / m = (${drive.toFixed(1)} - ${fk.toFixed(1)}) / ${state.mass} = ${a.toFixed(2)}$ $m/s^2$.</div>`;
            }

            displays.detailedAnalysis.innerHTML = html;
            if (window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise([displays.detailedAnalysis]);
            }
        }

        function draw() {
            if (!canvas || !ctx) return;
            if (canvas.width !== canvas.clientWidth) { canvas.width = canvas.clientWidth; canvas.height = canvas.clientHeight; }
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const rad = state.theta * (Math.PI / 180);
            const startX = 100, startY = canvas.height - 80, length = canvas.width - 200;
            const endX = startX + length, endY = startY - length * Math.tan(rad);
            
            // Visualisasi Dasar
            ctx.beginPath(); ctx.strokeStyle = "#cbd5e1"; ctx.setLineDash([5, 5]); ctx.moveTo(startX, startY); ctx.lineTo(endX + 50, startY); ctx.stroke(); ctx.setLineDash([]);
            ctx.fillStyle = "#94a3b8"; ctx.font = "italic 10px Inter"; ctx.fillText("Tanah (Horizontal)", startX + 150, startY + 20);

            // Bidang Miring
            ctx.beginPath(); ctx.strokeStyle = "#1e293b"; ctx.lineWidth = 6; ctx.moveTo(startX, startY); ctx.lineTo(endX, endY); ctx.stroke();
            ctx.fillStyle = "#1e293b"; ctx.font = "bold 11px Inter"; ctx.textAlign = "center";
            ctx.fillText("DASAR", startX, startY + 30);
            ctx.fillText("PUNCAK", endX, endY - 20);

            const size = 50; 
            const maxTrack = length - size;
            const bx = startX + (state.pos / 100) * maxTrack * Math.cos(rad);
            const by = startY - (state.pos / 100) * maxTrack * Math.sin(rad);

            ctx.save(); ctx.translate(bx, by); ctx.rotate(-rad);
            ctx.fillStyle = "#2563eb"; ctx.fillRect(0, -size, size, size);
            ctx.strokeStyle = "#1d4ed8"; ctx.lineWidth = 2; ctx.strokeRect(0, -size, size, size);
            
            const physics = calculatePhysics();
            ctx.fillStyle = "#1e293b"; ctx.font = "bold 11px Inter"; ctx.textAlign = "center";
            ctx.fillText(physics.statusText, size/2, -size - 55);

            // Vektor Gaya
            drawArrow(0, -size/2, -35, -size/2, "#60a5fa", "wx");
            if (state.fext !== 0) {
                const len = (state.fext / 120) * 80;
                if (state.fext < 0) drawArrow(size, -size/4, size + Math.abs(len), -size/4, "#ef4444", "Fext");
                else drawArrow(0, -size/4, -len, -size/4, "#ef4444", "Fext");
            }
            if (Math.abs(physics.fFriction) > 0.1) {
                const fDir = Math.sign(physics.fFriction); 
                const fStart = fDir > 0 ? 0 : size;
                drawArrow(fStart, -size/1.2, fStart + (fDir * 35), -size/1.2, "#f97316", "f");
            }
            ctx.restore();
        }

        function drawArrow(x1, y1, x2, y2, color, label) {
            const headlen = 8; const angle = Math.atan2(y2 - y1, x2 - x1);
            ctx.beginPath(); ctx.moveTo(x1, y1); ctx.lineTo(x2, y2); ctx.strokeStyle = color; ctx.lineWidth = 3; ctx.stroke();
            ctx.beginPath(); ctx.moveTo(x2, y2);
            ctx.lineTo(x2 - headlen * Math.cos(angle - Math.PI / 6), y2 - headlen * Math.sin(angle - Math.PI / 6));
            ctx.lineTo(x2 - headlen * Math.cos(angle + Math.PI / 6), y2 - headlen * Math.sin(angle + Math.PI / 6));
            ctx.closePath(); ctx.fillStyle = color; ctx.fill();
            ctx.fillStyle = color; ctx.font = "bold 9px Inter"; ctx.fillText(label, x2 + 5, y2);
        }

        function loop(timestamp) {
            const dt = (timestamp - state.lastTime) / 1000 || 0; state.lastTime = timestamp;
            const p = calculatePhysics();
            if (state.isRunning && state.isMoving) { 
                state.vel += p.a * dt; 
                const trackPixels = (canvas.width - 200 - 50);
                const deltaPos = (state.vel * 100 * dt / trackPixels) * 100; 
                state.pos += deltaPos;
                if (state.pos <= 0) { state.pos = 0; state.vel = 0; state.isMoving = false; }
                if (state.pos >= 100) { state.pos = 100; state.vel = 0; state.isMoving = false; }
            }
            draw(); 
            requestAnimationFrame(loop);
        }

        window.onload = () => { 
            initElements();
            if (typeof lucide !== 'undefined') lucide.createIcons(); 
            inputs.pos.addEventListener('input', (e) => { state.pos = parseInt(e.target.value); displays.pos.innerText = state.pos + "%"; state.vel = 0; state.isMoving = false; });
            inputs.theta.addEventListener('input', (e) => { state.theta = parseInt(e.target.value); displays.theta.innerText = state.theta + "°"; });
            inputs.mass.addEventListener('input', (e) => { state.mass = parseInt(e.target.value); displays.mass.innerText = state.mass + " kg"; });
            inputs.fext.addEventListener('input', (e) => { state.fext = parseInt(e.target.value); displays.fext.innerText = state.fext + " N"; });
            inputs.mus.addEventListener('input', (e) => { state.mus = parseFloat(e.target.value); displays.mus.innerText = state.mus.toFixed(2); });
            inputs.muk.addEventListener('input', (e) => { state.muk = parseFloat(e.target.value); displays.muk.innerText = state.muk.toFixed(2); });
            displays.startBtn.addEventListener('click', () => {
                state.isRunning = !state.isRunning;
                if (state.isRunning) { displays.playIcon.setAttribute('data-lucide', 'pause'); displays.playText.innerText = "Jeda"; displays.startBtn.classList.replace('bg-blue-600', 'bg-orange-600'); }
                else { displays.playIcon.setAttribute('data-lucide', 'play'); displays.playText.innerText = "Lanjut"; displays.startBtn.classList.replace('bg-orange-600', 'bg-blue-600'); }
                lucide.createIcons();
            });
            document.getElementById('reset-btn').addEventListener('click', () => { state.vel = 0; state.isMoving = false; state.isRunning = false; state.pos = parseInt(inputs.pos.value); displays.playIcon.setAttribute('data-lucide', 'play'); displays.playText.innerText = "Mulai"; displays.startBtn.classList.replace('bg-orange-600', 'bg-blue-600'); lucide.createIcons(); });
            requestAnimationFrame(loop); 
        };
    </script>
</body>
</html>